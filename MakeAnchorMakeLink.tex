% Helper to remove spaces (for MakeAnchor)
\makeatletter
\newcommand{\StripSpaces}[1]{%
  \begingroup
  \edef\x{\endgroup\zap@space#1 \empty}%
  \x
}
\makeatother

% Common function to normalize a name to a label-safe format
\newcommand{\MakeLabelName}[1]{%
  \edef\tempa{\detokenize{#1}}%
  \StripSpaces{\tempa}%
}

% MakeAnchor: create a label with normalized name
\newcommand{\MakeAnchor}[1]{%
  \edef\tempa{\detokenize{#1}}%
  \edef\anchorname{\expandafter\stripspaces\tempa}%
  \label{\anchorname}%
  \index{#1}#1%
}

% MakeSkillAnchor: create a label with normalized name
\newcommand{\MakeSkillAnchor}[1]{%
  \edef\tempa{\detokenize{#1}}%
  \edef\anchorname{\expandafter\stripspaces\tempa}%
  \label{\anchorname}%
  \index{Skill!#1}#1%
}

% MakePerkAnchor: create a label with normalized name
\newcommand{\MakePerkAnchor}[1]{%
  \edef\anchorname{\MakeLabelName{#1}}%
  \label{\anchorname}%
  \index{Perk!#1}#1%
}

% MakeLink: display text, link to page of the anchor
\newcommand{\MakeLink}[1]{%
  #1 (P.\pageref{\expandafter\stripspaces\detokenize{#1}})\index{#1}%
}

% MakeSkillLink: display text, link to page of the anchor
\newcommand{\MakeSkillLink}[1]{%
  #1 (P.\pageref{\expandafter\stripspaces\detokenize{#1}})\index{Skill!#1}%
}

% MakePerkLink: display text, link to page of the anchor
\newcommand{\MakePerkLink}[1]{%
  \edef\anchorname{\MakeLabelName{#1}}%
  #1 (P.\pageref{\anchorname})\index{Perk!#1}%
}
